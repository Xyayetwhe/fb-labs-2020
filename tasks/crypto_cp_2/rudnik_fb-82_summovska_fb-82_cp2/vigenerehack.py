import re
ciphertext = """
деьооуцмдурьдыегныьпуыккэаонтцчхлуучктвдджоаубуяцбхкугбэщешряцзывтшщяшхтяяуюйлрънпрйбдшзъняъмйнуьря
пьщгтуьзразхтпфгяжитхчьурвттдфанвзгьячрщюитобущузсшзпуыхнмвбуъняэаоемйнеорцбэзмюцйхлыпейжцбышяпщчсу
щкдбкалтозьевефямнумвеаыяпцезьуотпъяуччтшкъуньдцплчжурпэнямноннщтвддщоюнгкшцкуьщщдднтютэнцьмухрчбв
щгртчпщыупшоыуфщгхнжхуучехфщвчыыэееъщахььрхобщглэччзекцьэахатггъесюекчпнрщчозьтчмуцгшъмьаьлефуьррар
ишужыэюваелунэкззфвьюррвтецэцжемпвжшралризщцоьпнвхчхньтьцъоннтдфаъняэаозжярптлйжцщшрзтоьавхтмечэумэа
гнюявстуьччцрэезшсцхзяршуъхтанвчыбгпэзчбаьбхючрлщхткгзгьумыкэецрпшьтьатьдэкякоьпклэябфугэущфщазсфвйгтьр
ъеюаноннъвыанрзбчехуцокржзввщцшсъуньтнхквеачцвуэкшоучктвдджлрззесупютпфъцщпюзчдуызиххгусннтцхцньалтй
бпяувфкдкмйнеовяпкрртуьищюрйчрчбгркртяпщсжечзцыцркртяищюрйкпьщчцдчтеопьтункфхбщрыкытуужкыбжпэрстць
цутзркйфвчвыонйуцкмущрббйллтамупцнечвзюъбтзчелрахчэжьхъэдыбдуоьупкйфюуюпъндрйтзошжьаахзефетлаххпмвеа
ыъхпчпыомуьъщюнгйшряшццфпкужувлэвццшфакзыдвсгхнаркфюыввьрадфрсхтьслщржефряасдвчкчкрнкчкщудлбшмген
ьйзъвншяудъчесюрткцзбыьщвфежхртрпбзябфрйртьжжщзюпрхмчьсткдтжъинмржанчзцнвупцпуфрцдфщдщжьхцьекковщ
чэалчувэьсхшужбапмрнюхлхпумкшааьсхоокцьдкбзеэаонеезехазхкмжбщшяхчцтруучпужхчшмшпятръркозябьлррчуцкэр
йшгбознняхецщрбчшнрэаанзшиплхвчжщжбдлйшквгпцмефофхвлютрьтуупкъзшэаргрзечшужехзюбъьйрчусрябыкжцуялж
рйксрюхткуццаынфкдкхцлжпньэантзнйкцкехпщщдьщвюдюахооууфвхтызйзтушуоцхэмуэуйютььшьртлэяътчдзейкцупчп
олеанрхиыепоикмрлшязфюхеэюмсунршжфжфюйярншвршъфиъьжютйнхьончзггччдэтезэусршогуэзсютчзлазнсрбеъхтэкъ
умйнзбзйючуцрцтзвучрпкыдчынщмчсгцкпшешуфжмшсчръутубкбанфмюлочщпэубкбыдзйрхчтпоъчшкббшюмхиежжщдь
пчвюовзъкярудрпкйфюаьывуэкмйнумщщиэрсрпбехьпзызцгччюяхцчлщзишдгбцшюваазщюрччкюбяшнбнвчръпапрлэъят
деапюбънсвюютпътевзларотмвццлррйярьнпетйцбщвзъейуъюкпкйпхтцоюйднчофбмздиапмшсирщррсэяжбхщцхрезршвтк
гясцлкюцуфщяфуйпббчумхфзкщтрртовшгэпхсвкшцзуфтзщъэыбкшдщпрршщюбыьнчйччзязжпффэгхячейбябфрйтюбдщп
локкпцпнхгпшхщжрюячущгашфцачгмшъщрунпнужщьгэбшчьрзырцьюдущппрлчрлуеущхчуэлгххэецодфшужбсшмюойх
рррипкходзлюльчпщбчшевкдщалужхлржеьюсееьбюгзумьучжуцбчщстхчюрыккфпфддщюйкгшщыдцпешузняынвфыьър
шзьеавдууднхьейкпщфнцншйзкныккййпэъхнвузарьпфъзгбцлбрршаццжрйпщцанргюдуьакчпищэтцнинямщыфнфмзчтщм
яхцчлщудшфшшыьстнйкцкпууиьъяунъебмнбщкчмфэбыдъхчцрыехпщщдьуипмтпоьдуъкябяьнбрчйхцозетфщчшзхсяплш
гамжвэттявквбьадуыдвызькюзжхузххтдчюттзяуыткрсехзкввщзчтецущвтьтвваьзьаирзядуигщюъхнтччпсуучктфюгкжрфз
дэофбмцзеэкпфрцтрсрженьтгшъвувбхьшнъмзюсыъшичмрапапужудззтпечщюэъсвггчдяыуибварттгзчохнуйчзбцтпэнугчт
яяхьюлщрцжхлшяуйрсщааьжньюбуецзжшжуьщзйпдуеъвябущзрезхккяыфхяъуатупхйжужудздчежхрзвркурвэщсбпчдцмг
умюжбпэнсавупщбтпевтгшнюфзкпункчпвътъпхюьтщцгеыффхвлжакпкшцклпкгбщнныкднуямхедфюгкгыддкоьдцпешуп
цдькдчььоттфщюошъщьйуэьпкореэттяэтекуяошьпвшьщвфещищюрйптфъврчрряйыооеьклшгхзщпзшсьмнхклыдлкмтхнц
цщеупзсдщнэфеплекзкнчбэщбюояищррхтнжызщнэубушущтшффэдщсрпщцрлфущтщэвлрэуыехомжещщцашдтапрщруд
фрчбвщгртчхюжзттбзээщмхтядщаучэсяшяуюючжхлркрщтьхапзыньищрхтепьшзщсппчмлщрцжгпэтхнхкгшпунупуяыьэн
шмйунотнгзэбблжфащецывсшнщфчшзыныуаьжнхкеюеазюпчпщчпнлхшпбынъеюкоцоткйьддщбшрязутзртмяугьмггыечб
сусжббфрцххесььцназдбюэнютеьрыюзшнббфлкбдязьуеумрдыэхяъжтьрсртпдплэщяэежкпоеунклшгхзецезравъшпггаьсю
шътраврчведфщдоуичщюрлчрееойлэнйкцкпуыфрсъьбюнгнвцучшцзеэкпэагнььржъвъшяуюьндеьезчьрчбйэнтуййррошру
юбыуехтипщченцпфъъкфьувупуибмзшшдьдсдышыырубзбпкюлшчщпцоуцкчфиьлйсадкпьършжватвяыбичновъфвюфнвдуудкнйършклеаррыншнтрфуърчбьцябцчньшнгбкжпбрсаущелцйьпфцшвэнууьищюрзкфвфнцнсаеьрыюъштвлауцвуэкьррн
цкцъцщфрсятжаюкцуцбъчзвкгтжъкубмфяъшясрьйшьоскнщаохньряырхпепфщятцдэббучщкыпмфэеанаббещыжемкяатьб
бкмнчйхцьхгуэурсещркщкфпфдбфюзхиехщрхжкняваънткыкшцацкифюъуфяуыеыуучтдюбябдъудыщркцфнтктцзшфьчыь
детзчбвщбржтрщбпкнреевлмэуьумймтшдщаърфюйячзэрткъьяьняачяхлъсхтжщеьюцшчьрйябйпфьяаццшчяплшгшофвкд
щсюзтцчофхтдфшдънбнынэлфефовюйлцрцыхюсротхэччэьвудетйдехрепешдуужуптзхркцудзгюжзарьфтшъщаъкрвущеыц
ыецкьбйрбшйдуаьжньююатчзбныкэкгахршюсшдууйдсунутчвчъцнэпдечарржмвваэньшочщящньвядфщдочезлюкюпуюбр
щапмчтшьучжааоевзвквдмьбртуршхщзфеэкпцткффвгущюыццзщасуокжшшрмрэяшвцфкхббувщгтцьсжяндгкэцэюаюпеф
щюбйшщбоыннбфячлыпаупфееывхтьзрцыкотьачщгэебусуячшфлшэщбхььпаьжнмъььфьдуйчзхонуввйыгтнэчяпщъжкъиф
юфытъемзьменцпфъъйххртъънфткжкудзкхчыеваритобущуэткибоьтуопфлъпяьажуьбгжшффяцщлрэднаяскфффээриэккцэ
ювнмвяыущюынибхомжербачюжэевнпбчумзбддннбчьцшннуыюггъшдьпкэлаюцфрдбюшнхняиыофбммфгджоюйщрунпн
пожуьуфыгыкфшвплзяыьщбчежуьщзйчкщччьювбждэывйавжпэрсттчэръеуършшгэяыншукаюцйдешхщаюдйцкстуцмвцан
нанйбъьуахвжпбурмсчмшомуцкжпгкцшчччзшпннкхбсэрпфесщсвчжгщчяжлгьячзстецржшъняэнщешйщлпнфтйэнвуиплх
вчжмфлэкмгрдуьывькнфътхтанвчыбгпэсвцэкгхрдецбпштсвеачтцкиплхврытфдгэяэущпщчжецэеюсдзхфехктрьчэщкъэяоч
яюрттнчвьееывхтьзлювмчэйетчаюпвкфцсхшщщштннвфейвцпнхкепшрсххжкццфуьрцбдщмюньцэкгкхкюбфсзызйучфзйш
ощццрзпфзупьнлкнхжвхзэзйучфзвьвъшцндабжхщакзодщгъчъзеичщркйпньдоуючтчррсрйшофляйэцнютзцжуцвжушрзбче
хунчехвжэацорпичлрпнсвшхъсйшыьржчтдодетьуфчежхрззттлвцвлмшььтучкеямфэужцхиетррээхргбгэмюкьцэкдхпжббть
йюхесшьзтпнръсэяъпчпъьиеххэдьлегчочщпзртмвхярзбфершнзчщрееанзютьрьбжефвбуьщпюзукчъвцхзгыллмхфецэывдч
рьачцычдиплхвчжщжбужръузучывдрзбдьщияхяццбеншпбшцрпцевнтяфхкчфкдщалудкчызйэофюъптатеепутлкнгбфлпре
лешоунйужувуйррьчгуучтжщдсэзэкйхрхдунрьвацнгсдуоьмуьрдоыхнуйччщяншркяхцрмйнбеацхспнюбчхяъцйхкэвчжяжб
длуртчцучучшбябужйэущкшыршодщгъьйакичуртшфкьхгрвфешуыърчкнвчящзвуэкьсншлрюыюнжфумучъпунрзщъамлто
кыойзпнвдоьорруткбгкхкюбфлалрчслщзтжмфтдщцэуцюушмхшдфеомъыеифщщришоябшлрмцжеэкртэмдофлкбдиищщрз
шлхоэщерхбупбътшдыуьыъваьйнутныфзктцрпзьчрюдфпщюшхюгхреццйъехкепфтгюъянтшхъчкцъцщфшмвунуынпкщяе
мъыуичыоътшсвчапдпресщыгуйнетьлйсаокоьпкмэмюахяъжткоьпксвдшщлкрщчтлякофвюфншдчешхлщкцждвгнуоючесн
яатшщрхъпдычзкньитезеанлтвхесхьейкопхюррвкпруренцпфъъйалрипюезтлнщччшзсавунцжтшщжбюшнуувгпывднкаатт
зпзбуэьтширблчцалрчцэювэчвггаэзттчзьуошыхншгэбгкъууефутжжывкгюсиучыропозкчцнткбшъьпеьхдшапзэубучбгахрж
тшхнюььтзбиээоуеешябзбрляуеяевхаызыудплшгаыффгткрмуйаьшвчжрхнсьмхтядьрркцхжтшркюскьюручмхбыялцвудкъ
ьчурзьрдщсгьячрщюиъзлшгхнууцмжшввьржкчцнткбзябфрйтщяасдвкикмусхпжеетнзвбьйнопкрзбыэьюшзчтурвтещхогэп
юуъркыхрыбцдтыящниплхврвхжыдргркызлызлппьюгкйрпфчщыкцьтфаящмрмдевцннфпфяящбюиешвцфкхбьддщпшняи
рьехкцьыярйюкъухьдехзбэачзееярлявзмклуътфюъвунэтнпчфюашмхуыншоуцпужгафбрхьтзшрошпабэщгюощаььмнууаж
хцъщцъхщъвйчэаывюйрсянъьннахцыцшнзчеищррхтфхугщлшзиечьойпнщцацнбпчпухгубмьфемтсшчушохлппщяацнфец
ррафхтжкудумючелррэцшмфтгэпюодекезхчрхганяппзеьырюпмфтапмшсирщррсчзшшфухрегеыъзркжьетхяпхчммцфткбм
жюшяпзикъьзчцвябвщрбнацхцзхшофагжзеумувуфьэфркдщсрпямлщюкьууцацнбничжъуспчвязлфръчфрюдупреаанявквб
шьзмчвюбюьстуипщрврппюуюутэеифщъпгщтвыщщчыудеуъзттпфиепзакбчщювцъзшыгюпюзтъшосхйищаящръшотжгск
овчбхщбъуйуыйзнчвьячшзэайуаьждьсвбукжртдуьакзотзцфугшсдунобеютвчъэятуюхщткркурыщъдэамупцффшжхбйрмпц
уъщгрьпфгбчэоыдпкэьпеысщютьцгзичньозтажхъэплфечщъзюптвятшршкркурукяпфдавяаущецодцпчшушрахряпщрвучсв
чгркътьоуямесвядэлгъукржпвдыюауэщпюцинфямнубыоььбюкхтрфпуыфрсъъпшдйтщмйзэщббгэыотчфщъкткзжчврбэкъх
резцфкэрдщоюруцэцнупльбялрвевеыоуцфвыофлсмкгшьехзыфцбюутскынэунбчрлеанврйцььшрсэзыччюмхкьцэкчшьрдуя
лфгчехрфкзпфаующцъеячлъфефкщцвючшччпуужачкжуьудъешехцхъшчябфэъъзттлхэзкаждсхясебечцвпкгфэъгзэпчсуцде
ъбжжяуфсузюьштеыпщаохзьняцьцпкчююыюусрпеоншхцчээетхнщзбшьыэобфвввщрвуклляурэъфюъчъбркэлщкнмжджхн
рхъдеььукчкяуапмрнйесуоаынрузщпюэежжцчфшищаъэывнмуьшвмкнфяяргшхьпэьтэкопхгроюььсюарзысвяяукшьйушоъ
жпньэанмхльтлакткожшбрпмпчмлщрцжужгтшмлсочщъэйшуьибщпъебчщызмкощктцзбущкыжзтчрзвеьйррянтркйэффэей
брлдшйэрйърхааьсмзьищфкмчкюуьннюжркщырччреыдьюъльтдцпкфвюбяыдиеьчпщбцпгурдщсэеишдыэомрггаьпртуэрл
фучзьадрпхцезлщрткуцбфьдсайбчьикьопачпняшиплщкйкищыюжрыночщезршдщэьщсюхтоньдцймзсбщвюйкъщткчммф
юагяенифуасуосвюаоньселранглкжпччтфещтщбиксвебвщйркачыцжыкфрвакрэнвеьрргцэеюопзакбчщюъецпщэтсдвццуш
огасвбшхщоюэвевуеуьряпьщмхйьрлуфцйхбугноаущншдкншфеэехзбперзшртппзщящвюзюйщюпунрьрдщоючесюефуырц
дччмхйьрлуфцйфвкдщмглдушбдуьмлшююмрсщйыбефшпфчамзыуибсупньюсеаонсквнхьдефржбвщвюйчлрцдушгдущус
мтьрзхбженвщчшявагйуюзпьрдлтумбфьпэьтэккцдчшяинънчывмтщщдьудфегащфкртжфщчънеузугунньрлаангашъшнцжк
хккшэзешмднпцткффвгклаххьчназеьтщюастшцгуэюксмзщюасдбнынэрвхппрэтььвебнчрзкърадъкэйеццвоучхкцусуппйес
ьызолзяыьщбьевкшкмнууюгрвдэттоэьщтшзчбътгюскпцуыецкцодлшшрядпоазпщщгъшйгныечйфхпгзсдвсюжтдшусхпощ
аящоанърлякртгщюъхнтеязлюзтжмзбцшзьцвуньомктффаэяыегегцпешмфътцнббочщрвхппрэтшдяхеьзпэркйфяесешчукфб
гхкфффнцнэкеьрыючшдщдчцнвувбхькмчвяыйэняункцйойчбадбщпшряныбеехкепфщстегцбупетжщеьщбррьтхьсуэньйчн
ъбубнфхжуърцоындамярлрдавкжбыьнауопрехжтйгбцятаеэпуэвйкзжатцнсзейшьлхэмщвтвйрпдноржхэевьдщкбччдьбмум
вжусъяыпчмлыкстжщегррвхччщфзцфпьцтчз
"""
ciphertext = re.sub('\n','',ciphertext)
LETTERS = 'абвгдежзийклмнопрстуфхцчшщъыьэюя'
russian_map = {letter:i for i,letter in enumerate(LETTERS)}
russian_inv_map = {russian_map[i]: i  for i in LETTERS}

def split_by_keylen(ciphertext,keylen):
    arr_of_parts = []
    for i in range(0,keylen):
        part_str = ''
        for j in range(i,len(ciphertext),keylen):
            part_str += ciphertext[j]
        arr_of_parts.append(part_str)
    return arr_of_parts


def icx(splited_strings):
    arr_of_icx = []
    for splited_string in splited_strings:
        len_of_splited_string = len(splited_string)
        letters_map = {i:0 for i in LETTERS}
        for letter in splited_string:
            letters_map[letter] += 1
        arr = sum([letters_map[item] * (letters_map[item] - 1) for item in letters_map])
        div = len_of_splited_string * (len_of_splited_string - 1)
        arr_of_icx.append(arr / div)
    return arr_of_icx

def not_white_noise(arr_of_icx):
    for icx in arr_of_icx:
        if not 0.049 <= icx <= 0.072:
            return False
    return True

def find_key_len(ciphertex):
    probable_keys = []
    for key_len in range(2,31):
        if not_white_noise(icx(split_by_keylen(ciphertext,key_len))):
            #print("{}: {}".format(key_len,icx(split_by_keylen(ciphertext,key_len))))
            probable_keys.append(key_len)
    return probable_keys


def mutal_icx(substr1,substr2):
    lenght_of_substr1 = len(substr1)
    lenght_of_substr2 = len(substr2)
    letter_map1 = {i:0 for i in LETTERS}
    letter_map2 = {i:0 for i in LETTERS}
    for letter in substr1:
        letter_map1[letter] += 1
    for letter in substr2:
        letter_map2[letter] += 1
    for letter in letter_map1:
        letter_map1[letter] += letter_map1[letter] / lenght_of_substr1
    for letter in letter_map2:
        letter_map2[letter] += letter_map2[letter] / lenght_of_substr2

    sum_of_freq = sum([letter_map1[letter] * letter_map2[letter] for letter in letter_map1])

    #letter_freq_str1 = sum([letter_map1[letter] for letter in letter_map1])
    #letter_freq_str2 = sum([letter_map2[letter] for letter in letter_map2])
    #letter_freq_product = letter_freq_str1 * letter_freq_str2
    sub1sub2_len = lenght_of_substr1 * lenght_of_substr2
    result = sum_of_freq / sub1sub2_len
    return result





